<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wedding RSVP Manager</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #fff;
      color: #000;
      padding: 30px;
      margin: 0;
    }

    h1 {
      color: #f86791;
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    /* Countdown text */
    .countdown {
      text-align: center;
      font-size: 1.1em;
      color: #a0374f;
      margin-bottom: 30px;
      font-weight: bold;
    }

    .container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #content, #summary-panel {
      background: #fff;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      /* removed forced scroll */
    }

    #content {
  flex: 1 1 600px;
  min-width: 320px;
}

#summary-panel {
  width: 300px;
}

/* Add this inside your existing media query */
@media (max-width: 768px) {
  .container {
    flex-direction: column-reverse;
    gap: 20px;
  }

  #content,
  #summary-panel {
    flex: 1 1 100%;
    width: 100%;      /* <-- make both panels full-width on mobile */
    min-width: unset; /* <-- allow shrinking smaller than 320px */
  }
}

    h2 {
      font-size: 1.3em;
      color: #a0374f;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      border-bottom: 2px solid #f86791;
      padding-bottom: 5px;
      margin-top: 30px; /* extra spacing above group headings */
    }

    h2:first-of-type {
      margin-top: 0; /* don’t push down the very first section */
    }

    h2 button {
      font-size: 20px;
      background: none;
      border: none;
      color: #f86791;
      cursor: pointer;
    }

    .guest {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f9f9f9;
      padding: 6px 10px;
      margin: 6px 0;
      border-radius: 6px;
      border-left: 4px solid #f86791;
      font-size: 0.9em;
    }

    .loading, .error {
      text-align: center;
      color: #a0374f;
    }

    /* Progress Bar */
    .progress-wrapper {
      background: #eee;
      height: 16px;
      border-radius: 6px;
      overflow: hidden;
      margin: 10px 0;
      width: 100%;
      position: relative;
    }

    .progress-bar {
      background: #f86791;
      height: 100%;
      width: 0%;
      transition: width 0.4s ease;
    }

    .progress-label {
      font-size: 12px;
      text-align: center;
      line-height: 16px;
      color: #000;
      font-weight: bold;
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
    }

    /* Modal Styling */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    #modal .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      position: relative;
    }

    /* Close button */
    #modal .close-btn {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 20px;
      font-weight: bold;
      color: #a0374f;
      background: none;
      border: none;
      cursor: pointer;
    }

    #modal input[type="text"] {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #modal label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    #modal .radio-group {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }

    #modal button {
      background: #a0374f;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 14px;
    }

    .summary-section h3 {
      margin-bottom: 8px;
      color: #a0374f;
      font-size: 1.1em;
    }

    .summary-section ul {
      padding-left: 20px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column-reverse;
        gap: 20px;
      }

      #summary-panel {
        width: 100%;
      }
      #modal {
       width: 100%;
    }
  </style>
</head>
<body>

  <h1>Wedding RSVP Manager</h1>
  <p id="countdown" class="countdown"></p>

  <div class="container">
    <main id="content">
      <p class="loading">Loading guests...</p>
    </main>
    <aside id="summary-panel">
      <h2>Summary</h2>
      <!-- Progress bar container -->
      <div class="progress-wrapper">
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-label" id="progress-label">0%</div>
      </div>
      <div id="summary-content">Loading...</div>
    </aside>
  </div>

  <!-- Modal -->
  <div id="modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">×</button>
      <h3>Add Guest</h3>
      <label for="guestName">Name</label>
      <input type="text" id="guestName" placeholder="Main guest name">

      <label for="linkedGuests">Linked Guest(s)</label>
      <input type="text" id="linkedGuests" placeholder="Comma-separated names">

      <label>Attendance Type</label>
      <div class="radio-group">
        <label><input type="radio" name="attendanceType" value="Day" checked> Day</label>
        <label><input type="radio" name="attendanceType" value="Evening"> Evening</label>
      </div>

      <button onclick="submitGuest()">Add</button>
    </div>
  </div>

  <script>
    const API_URL = 'https://api.sheetbest.com/sheets/d965d241-ad99-408a-81af-f05a7215b59f';
    let selectedGroup = '';

    function updateProgressBar(guests) {
      const total = guests.length;
      const responded = guests.filter(g => g.Response && g.Response.trim() !== '').length;
      const percent = total > 0 ? Math.round((responded / total) * 100) : 0;

      document.getElementById('progress-bar').style.width = percent + '%';
      document.getElementById('progress-label').textContent = `${responded}/${total} (${percent}%)`;
    }

    function createGuestElement(guest) {
      const div = document.createElement('div');
      div.className = 'guest';

      const icon = document.createElement('span');
      const res = (guest.Response || '').trim().toLowerCase();
      icon.textContent = res === 'yes, i will be there' ? '✅' :
                         res === "sorry i can't make it" ? '❌' :
                         '⏳';

      const name = document.createElement('span');
      name.textContent = guest.Name;

      if ((guest.Allergies || '').trim().toLowerCase() === 'yes') {
        const allergyIcon = document.createElement('span');
        allergyIcon.textContent = '⚠️';
        allergyIcon.title = 'Allergies reported';
        allergyIcon.style.color = 'red';
        allergyIcon.style.marginLeft = '6px';
        name.appendChild(allergyIcon);
      }

      const attendanceType = guest.AttendanceType || 'N/A';
      const details = document.createElement('div');
      details.style.marginLeft = '12px';
      details.style.fontSize = '0.9em';
      details.style.color = '#a0374f';

      if (attendanceType.toLowerCase() === 'evening') {
        details.innerHTML = `<div><strong>Attendance:</strong> ${attendanceType}</div>`;
      } else {
        const mealPreference = guest['Meal type'] || 'None';
        details.innerHTML = `<div><strong>Attendance:</strong> ${attendanceType}</div>
                             <div><strong>Meal:</strong> ${mealPreference}</div>`;
      }

      div.appendChild(icon);
      div.appendChild(name);
      div.appendChild(details);

      return div;
    }

    function createGroupSection(groupName, guests) {
      const section = document.createElement('section');

      const header = document.createElement('h2');
      const span = document.createElement('span');
      span.textContent = groupName;

      const addBtn = document.createElement('button');
      addBtn.textContent = '+';
      addBtn.onclick = () => {
        selectedGroup = groupName;
        document.getElementById('modal').style.display = 'flex';
      };

      header.appendChild(span);
      header.appendChild(addBtn);
      section.appendChild(header);

      guests.forEach(g => section.appendChild(createGuestElement(g)));
      return section;
    }

    function summarizeGuests(guests, type) {
      const filtered = guests.filter(g => (g.AttendanceType || '').toLowerCase() === type.toLowerCase());
      const total = filtered.length;
      const responses = {};
      const meals = {};

      filtered.forEach(g => {
        const r = (g.Response || 'Pending').trim();
        responses[r] = (responses[r] || 0) + 1;

        if (type.toLowerCase() === 'day') {
          const meal = g['Meal type'] || 'None';
          meals[meal] = (meals[meal] || 0) + 1;
        }
      });

      return { total, responses, meals };
    }

    function renderSummary(guests) {
      updateProgressBar(guests); // update progress bar

      const div = document.getElementById('summary-content');
      div.innerHTML = '';

      ['Day', 'Evening'].forEach(type => {
        const { total, responses, meals } = summarizeGuests(guests, type);

        const section = document.createElement('div');
        section.className = 'summary-section';

        const h3 = document.createElement('h3');
        h3.textContent = `${type} Guests`;
        section.appendChild(h3);

        const ul = document.createElement('ul');
        const totalLi = document.createElement('li');
        totalLi.innerHTML = `<strong>Total:</strong> ${total}`;
        ul.appendChild(totalLi);

        Object.entries(responses).forEach(([k, v]) => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${k}:</strong> ${v}`;
          ul.appendChild(li);
        });

        if (type === 'Day') {
          const mealTitle = document.createElement('li');
          mealTitle.innerHTML = `<strong>Meal Type Totals:</strong>`;
          ul.appendChild(mealTitle);

          Object.entries(meals).forEach(([k, v]) => {
            const li = document.createElement('li');
            li.style.marginLeft = '15px';
            li.textContent = `${k}: ${v}`;
            ul.appendChild(li);
          });
        }

        section.appendChild(ul);
        div.appendChild(section);
      });
    }

    async function loadData() {
      const content = document.getElementById('content');
      const summary = document.getElementById('summary-content');
      try {
        const res = await fetch(API_URL);
        const guests = await res.json();

        content.innerHTML = '';
        const groups = {};
        guests.forEach(g => {
          const group = g.Group || 'Ungrouped';
          if (!groups[group]) groups[group] = [];
          groups[group].push(g);
        });

        Object.entries(groups).forEach(([groupName, groupGuests]) => {
          content.appendChild(createGroupSection(groupName, groupGuests));
        });

        renderSummary(guests);
      } catch (e) {
        content.innerHTML = `<p class="error">Failed to load guests</p>`;
        summary.innerHTML = '';
      }
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      document.getElementById('guestName').value = '';
      document.getElementById('linkedGuests').value = '';
    }

    async function submitGuest() {
      const name = document.getElementById('guestName').value.trim();
      const linkedStr = document.getElementById('linkedGuests').value.trim();
      const attendanceType = document.querySelector('input[name="attendanceType"]:checked').value;

      if (!name) {
        alert('Please enter a name.');
        return;
      }

      const linkedGuests = linkedStr
        ? linkedStr.split(',').map(n => n.trim()).filter(n => n && n !== name)
        : [];

      const allGuests = [];

      allGuests.push({
        Name: name,
        LinkedGuests: linkedGuests.join(', '),
        AttendanceType: attendanceType,
        Group: selectedGroup
      });

      linkedGuests.forEach(lg => {
        const others = [name, ...linkedGuests.filter(n => n !== lg)];
        allGuests.push({
          Name: lg,
          LinkedGuests: others.join(', '),
          AttendanceType: attendanceType,
          Group: selectedGroup
        });
      });

      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(allGuests)
        });

        closeModal();
        loadData();
      } catch (e) {
        alert('Error adding guests. Please try again.');
      }
    }

    window.onclick = function (e) {
      if (e.target.id === 'modal') closeModal();
    }

    // Countdown (days only)
    const weddingDate = new Date("2026-06-28T12:00:00").getTime();
    function updateCountdown() {
      const now = new Date().getTime();
      const diff = weddingDate - now;

      if (diff <= 0) {
        document.getElementById("countdown").textContent = "💍 It's Wedding Day!";
        clearInterval(timer);
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      document.getElementById("countdown").textContent =
        `${days} days until the wedding 💕`;
    }
    const timer = setInterval(updateCountdown, 1000 * 60 * 60); // update hourly
    updateCountdown();

    loadData();
  </script>
</body>
</html>










